import{l as h,i as _,u as ee}from"./faceLandmark-BxCGo5NV.js";import{S as te,C as oe,F as ne,P as ie,W as ae,A as se,D as re,V as ce,R,N as de,a as V,M as g,b as z,c as le,d as pe,e as ue,G as fe,m as me,l as ye,r as we,f as xe,g as he,t as ge,h as ze,u as Me,i as $,j}from"./faceModel-DY2VKlek.js";const n={x:0,y:0,z:0},x={x:0,y:0,z:0};let E=-1;function Le(){if(!h||h.length===0)return;const t=h[33],e=h[263],c=h[168];if(!t||!e||!c)return;const W=(t.x+e.x)/2,d=(t.y+e.y)/2,u=e.x-t.x,s=e.y-t.y,i=Math.sqrt(u*u+s*s);x.x=W*2-1,x.y=-(d*2-1),E<0&&i>0&&(E=i),E>0&&(x.z=i/E-1)}function Pe(){n.x+=(x.x-n.x)*.1,n.y+=(x.y-n.y)*.1,n.z+=(x.z-n.z)*.1}function Ee(t){t&&(t.innerHTML=`
        Head Pose:<br>
        x: ${n.x.toFixed(3)}<br>
        y: ${n.y.toFixed(3)}<br>
        z: ${n.z.toFixed(3)}
    `)}function We(){Le(),Pe()}async function Fe(){await _();const t=new te;t.background=new oe(0),t.fog=new ne(0,1,100);const e=new ie(75,window.innerWidth/window.innerHeight,.1,1e3),c=new ae({antialias:!0});c.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(c.domElement);const W=new se(16777215,.5);t.add(W);const d=new re(16777215,1);d.position.set(0,0,0),d.castShadow=!0,t.add(d),t.add(d.target);const u=document.createElement("video");u.src="/walls4.mp4",u.loop=!0,u.muted=!0,u.play();const s=new ce(u);s.wrapS=R,s.wrapT=R,s.magFilter=de;const i=20,D=200,O=new V(i,D),A=new V(D,i),F=s.clone();F.needsUpdate=!0,F.repeat.set(4,20);const N=new g({color:4210752,map:F}),v=new z(O,N);v.rotation.x=-Math.PI/2,v.position.y=-i/2,t.add(v);const k=s.clone();k.needsUpdate=!0,k.repeat.set(4,20);const X=new g({color:4210752,map:k}),G=new z(O,X);G.rotation.x=Math.PI/2,G.position.y=i/2,t.add(G);const H=s.clone();H.needsUpdate=!0,H.repeat.set(20,4);const Y=new g({color:4210752,map:H}),T=new z(A,Y);T.rotation.y=Math.PI/2,T.position.x=-i/2,t.add(T);const b=s.clone();b.needsUpdate=!0,b.repeat.set(20,4);const J=new g({color:4210752,map:b}),C=new z(A,J);C.rotation.y=-Math.PI/2,C.position.x=i/2,t.add(C),le(),pe(),ue();const M=new fe;M.add(me,ye,we,xe,he,ge),t.add(M);const L=[];function B(o,a,y){const l=new ze(2,32,16),p=new g({color:8421504}),m=new z(l,p);m.position.set(o,a,y),t.add(m),L.push(m)}B(5,5,-30),B(-2,2,-40),B(7,5,-50);const f={w:!1,a:!1,s:!1,d:!1};window.addEventListener("keydown",o=>{o.key.toLowerCase()in f&&(f[o.key.toLowerCase()]=!0)}),window.addEventListener("keyup",o=>{o.key.toLowerCase()in f&&(f[o.key.toLowerCase()]=!1)}),window.addEventListener("resize",()=>{e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight)}),document.getElementById("fullscreen-button").addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()});const K=document.getElementById("head-pose-container"),U=document.getElementById("game-over-overlay"),r=new $(0,0,0),P=.3;let I=!1;function Q(o,a){const y=o.x-a.x,l=o.y-a.y,p=o.z-a.z;return Math.sqrt(y*y+l*l+p*p)}function Z(){U.style.display="none",r.set(0,0,0);let o=30;for(const a of L)a.position.x=Math.random()*10-5,a.position.y=Math.random()*10-5,a.position.z=-o,o+=10;I=!1,c.setAnimationLoop(q)}function q(){if(ee(),We(),Me(),Ee(K),r.z-=P,f.s&&(r.z+=P),f.a&&(r.x-=P),f.d&&(r.x+=P),r.z<-50){r.z=0;let w=30;for(const S of L)S.position.x=Math.random()*10-5,S.position.y=Math.random()*10-5,S.position.z=-w,w+=10}const o=n.z*-10,a=n.x*-10,y=n.y*10,l=i/2,p=1;e.position.x=j.clamp(r.x+a,-l+p,l-p),e.position.y=j.clamp(r.y+y,-l+p,l-p),e.position.z=r.z+o,e.rotation.y=n.x*-.5,e.rotation.x=n.y*-.5;for(const w of L)if(Q({x:e.position.x,y:e.position.y,z:e.position.z-2},{x:w.position.x,y:w.position.y,z:w.position.z})<3){I||(I=!0,U.style.display="flex",c.setAnimationLoop(null),setTimeout(Z,2e3));return}M.position.set(e.position.x,e.position.y,e.position.z-2),M.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),d.position.copy(e.position);const m=new $;e.getWorldDirection(m),m.add(e.position),d.target.position.copy(m),d.target.updateMatrixWorld(),c.render(t,e)}c.setAnimationLoop(q)}Fe();
