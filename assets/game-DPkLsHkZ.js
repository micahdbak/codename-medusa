import{i as R,u as Z}from"./faceLandmark-BxCGo5NV.js";import{S as H,C as U,F as A,P as N,W as X,A as Y,D,V,R as v,N as j,a as k,M as u,G as q,b as J,c as L,d as m,e as C,E as h}from"./three.module-0uv1M5cs.js";import{d as K,s as p,u as Q}from"./headPose-6Lsff1ri.js";import{c as _,a as $,b as ee,m as te,u as ne}from"./faceModel-XAEEDs4G.js";const e={scene:{backgroundColor:0,fogNear:1,fogFar:100},camera:{fov:75,near:.1,far:1e3},lighting:{ambientColor:16777215,ambientIntensity:.5,directionalColor:16777215,directionalIntensity:1},tunnel:{videoSrc:"/walls4.mp4",width:20,length:200,resetZ:-50},player:{moveSpeed:.3,headPoseMultiplierX:-10,headPoseMultiplierY:10,headPoseMultiplierZ:-10,headRotationMultiplierX:-.5,headRotationMultiplierY:-.5},item:{count:3,initialSpawnZ:-30,spawnZIncrement:-10,collisionRadius:2.5}};let s,i,d,l,f;const t={isGameOver:!1,cameraBasePosition:new m(0,0,0),items:[],keys:{w:!1,a:!1,s:!1,d:!1}};let S,x;function oe(){s=new H,s.background=new U(e.scene.backgroundColor),s.fog=new A(e.scene.backgroundColor,e.scene.fogNear,e.scene.fogFar),i=new N(e.camera.fov,window.innerWidth/window.innerHeight,e.camera.near,e.camera.far),d=new X({antialias:!0}),d.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(d.domElement)}function ie(){const n=new Y(e.lighting.ambientColor,e.lighting.ambientIntensity);s.add(n),l=new D(e.lighting.directionalColor,e.lighting.directionalIntensity),l.position.set(0,0,0),l.castShadow=!0,s.add(l),s.add(l.target)}function ae(){const n=document.createElement("video");n.src=e.tunnel.videoSrc,n.loop=!0,n.muted=!0,n.play();const o=new V(n);o.wrapS=v,o.wrapT=v,o.magFilter=j;const r=(E,F,T,O)=>{const w=new L(E,F);return w.position.copy(T),w.rotation.copy(O),s.add(w),w},a=new k(e.tunnel.width,e.tunnel.length),c=new k(e.tunnel.length,e.tunnel.width),y=o.clone();y.needsUpdate=!0,y.repeat.set(4,20);const b=new u({color:4210752,map:y});r(a,b,new m(0,-20/2,0),new h(-Math.PI/2,0,0));const g=o.clone();g.needsUpdate=!0,g.repeat.set(4,20);const G=new u({color:4210752,map:g});r(a,G,new m(0,e.tunnel.width/2,0),new h(Math.PI/2,0,0));const P=o.clone();P.needsUpdate=!0,P.repeat.set(20,4);const W=new u({color:4210752,map:P});r(c,W,new m(-20/2,0,0),new h(0,Math.PI/2,0));const M=o.clone();M.needsUpdate=!0,M.repeat.set(20,4);const z=new u({color:4210752,map:M});r(c,z,new m(e.tunnel.width/2,0,0),new h(0,-Math.PI/2,0))}function se(){_(),$(),ee(),f=new q,f.add(te),s.add(f)}function re(){const n=new J(2,32,16),o=new u({color:8421504});for(let r=0;r<e.item.count;r++){const a=new L(n,o);s.add(a),t.items.push(a)}}function B(){let n=e.item.initialSpawnZ;for(const o of t.items)o.position.x=Math.random()*10-5,o.position.y=Math.random()*10-5,o.position.z=n,n+=e.item.spawnZIncrement}function le(){window.addEventListener("keydown",o=>{o.key.toLowerCase()in t.keys&&(t.keys[o.key.toLowerCase()]=!0)}),window.addEventListener("keyup",o=>{o.key.toLowerCase()in t.keys&&(t.keys[o.key.toLowerCase()]=!1)}),window.addEventListener("resize",()=>{i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight)}),document.getElementById("fullscreen-button").addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}),S=document.getElementById("head-pose-container"),x=document.getElementById("game-over-overlay")}function I(){x.style.display="none",t.cameraBasePosition.set(0,0,0),B(),t.isGameOver=!1,d.setAnimationLoop(pe)}function ce(){t.cameraBasePosition.z-=e.player.moveSpeed,t.keys.s&&(t.cameraBasePosition.z+=e.player.moveSpeed),t.keys.a&&(t.cameraBasePosition.x-=e.player.moveSpeed),t.keys.d&&(t.cameraBasePosition.x+=e.player.moveSpeed);const n=p.x*e.player.headPoseMultiplierX,o=p.y*e.player.headPoseMultiplierY,r=p.z*e.player.headPoseMultiplierZ,a=1,c=e.tunnel.width/2;i.position.x=C.clamp(t.cameraBasePosition.x+n,-c+a,c-a),i.position.y=C.clamp(t.cameraBasePosition.y+o,-c+a,c-a),i.position.z=t.cameraBasePosition.z+r,i.rotation.y=p.x*e.player.headRotationMultiplierY,i.rotation.x=p.y*e.player.headRotationMultiplierX}function de(){for(const n of t.items)if(i.position.distanceTo(n.position)<e.item.collisionRadius){t.isGameOver||(t.isGameOver=!0,x.style.display="flex",d.setAnimationLoop(null),setTimeout(I,2e3));return}}function me(){t.cameraBasePosition.z<e.tunnel.resetZ&&(t.cameraBasePosition.z=0,B()),f.position.set(i.position.x,i.position.y,i.position.z-2),f.rotation.copy(i.rotation),l.position.copy(i.position);const n=new m;i.getWorldDirection(n),n.add(i.position),l.target.position.copy(n),l.target.updateMatrixWorld()}function pe(){Z(),Q(),ne(),K(S),ce(),de(),!t.isGameOver&&(me(),d.render(s,i))}async function ue(){await R(),oe(),ie(),ae(),se(),re(),le(),I()}ue();
